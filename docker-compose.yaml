services:
  comfy-ui:
    build:
      context: /docker
      args:
          - IMAGE_VERSION
          - COMFYUI_VERSION
          - COMFYUI_MANAGER_VERSION
    ports:
      - "${HTTP_PORT:-8188}:8188"
    volumes:
      - models:/comfyUI/models
      - custom-nodes:/comfyUI/custom_nodes
      - ./data/outputs:/comfyUI/output
    stop_signal: SIGKILL
    tty: true
    deploy:
      resources:
        reservations:
          devices:
              - driver: nvidia
                device_ids: ['0']
                capabilities: [compute, utility]
volumes:
  models:
  custom-nodes:
